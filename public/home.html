<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="./homestyle.css">
    <link rel="stylesheet" href="./navbarstyle.css">
    <script src="https://kit.fontawesome.com/06c04fea00.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>
<body id="bdy">
    <nav class="nav">
        <a href="/home">Home</a>
        <a href="/info">+Información</a>
        <button class="titi" id="logoutbutton" type="submit">Logout</button>
    </nav>

    <main>
      <h1 style="text-align: center;">DiabetesCare</h1>
        <div class="btn-container"><button class="getT" id="getTemperature" type="submit">Actualizar información del dispositivo</button></div>
        <article class="temperature-container">
          <label for="">Temperatura actual del dispositivo: </label><div id="temperaturetext">25°C</div>
    </article>
        <div style="display: flex; gap: 2rem; justify-content: center; align-items: center; flex-direction: column;"><h2 style="text-align: center;">Estado de los espacios</h2>
          <div><a href="/rellenar">Modificar información</a></div></div>
        <article class="buttons-container">
            <article id="container1" class="cont">
              <div class="l">Espacio 1</div>
              <div>Estado: <p class="b" id="b1">VACIO</p></div>
              <div>Dosis máxima: <p class="b" id="max1"></p></div>
              <div>Dosis actual: <p class="b" id="actuales1"></p></div>
              <div>Dosis a tomar: <p class="b" id="d1"></p></div>
              <div>
                <a href="/rellenar" class="btnmodificar" id="btnm1">Modificar</a>
                <button class="btnmodificar" id="restar1" onclick="restar1()" style="border: none;">Restar una dosis</button>
              </div>
            </article>
            <article id="container2"  class="cont">
              <div class="l">Espacio 2</div>
              <div>Estado: <p class="b" id="b2">VACIO</p></div>
              <div>Dosis máxima: <p class="b" id="max2"></p></div>
              <div>Dosis actual: <p class="b" id="actuales2"></p></div>
              <div>Dosis a tomar: <p class="b" id="d2"></p></div>
              <div><a href="/rellenar" class="btnmodificar" id="btnm2">Modificar</a></div>
              <button class="btnmodificar" id="restar2" onclick="restar2()" style="border: none;">Restar una dosis</button>
            </article>
            <article id="container3" class="cont">
              <div class="l">Espacio 3</div>
              <div>Estado: <p class="b" id="b3">VACIO</p></div>
              <div>Dosis máxima: <p class="b" id="max3"></p></div>
              <div>Dosis actual: <p class="b" id="actuales3"></p></div>
              <div>Dosis a tomar: <p class="b" id="d3"></p></div>
              <div><a href="/rellenar" class="btnmodificar" id="btnm1">Modificar</a></div>
              <button class="btnmodificar" id="restar3" onclick="restar3()" style="border: none;">Restar una dosis</button>
            </article>
            </article>

    
      
        <div class="modal-bg" id="modalBg">a</div>    
        <div class="emergente" style="display: none;">
          <span class="close" onclick="cerrarModal()">&times;</span>
          Datos reestablecidos correctamente.
        </div>

        
        <!-- modal -->
        <div class="modal-bg" id="modalBg"></div>
        <div class="modal" id="cuidadoModal">
            <div class="modal-content">
              <span class="close" onclick="cerrarModal()">&times;</span>
              <p>Cuidado: La temperatura es extrema. ¡Tenga precaución!</p>
            </div>
          </div>
        <!-- modal -->

        <article class="historial-container">
            <h2>Historial</h2>
        <p style="text-align: center;">Se muestran los registros de temperatura relevantes, además del horario.</p>
        <div style="display: flex; gap: 2rem;"><label for="">Actualizar historial temperaturas</label><a href="/home"></a></div>
      </article>
        <section class="list-container">
            <div id="temperaturesList" style="display: flex; flex-direction: column; gap: 2rem; justify-content: center; align-items: center; font-size: 2.5rem;">
              <!-- agregado con JS -->
            </div>
        </section>
    </main>
    
    <script src="./js/alerta.js"></script>
    <script src="./js/getTemperature.js"></script>
    <script src="./js/getTemperatures.js"></script>
    <script src="./js/salir.js"></script>

    <script>
    function cerrarModal(){
      const modalBg = document.getElementById("modalBg");
      const modal = document.getElementById("cuidadoModal");
      const cambiarcolor = document.getElementById("temperaturetext");

      cambiarcolor.style.textDecoration = "true";
      modalBg.style.display = "none";
      modal.style.display = "none";
    }

    </script>

<style>

.modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 20px;
  background-color: #fff;
  z-index: 2; /* Asegura que esté por encima de la capa de fondo */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra suave */
}

.close {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 20px;
  cursor: pointer;
}

.btnmodificar{
  border: none;
  outline: none;
  padding: 1rem;
  border-radius: 15px;
  margin: 1rem 0rem;
  background: rgb(0, 198, 224);
  color: white;
  transition: background .2s ease;
}

.btnmodificar:hover{
  background: rgb(0, 117, 133);
}

</style>

<script>
  function restar1(){
    const cookieString = document.cookie;
    const cookies = cookieString.split('; ');

    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].split('=');
        const cookieName = cookie[0];
        const cookieValue = cookie[1];

        if (cookieName === 'token') {
            token = cookieValue;
            break;
        }
    }

    if(token == null || !token){
        window.location.href = "/";
    }else{
        fetch('https://ticsproject.onrender.com/restar1', {
        method: 'GET',
        headers: {
            'token': token,
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data =>{
            
            if(data.success == "true"){
                window.location.href = '/home';
            }else{
                window.location.href = '/fallo';
            }
        })
    }
}

function restar2(){
    const cookieString = document.cookie;
    const cookies = cookieString.split('; ');

    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].split('=');
        const cookieName = cookie[0];
        const cookieValue = cookie[1];

        if (cookieName === 'token') {
            token = cookieValue;
            break;
        }
    }

    if(token == null || !token){
        window.location.href = "/";
    }else{
        fetch('https://ticsproject.onrender.com/restar2', {
        method: 'GET',
        headers: {
            'token': token,
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data =>{
            
            if(data.success == "true"){
                window.location.href = '/home';
            }else{
                window.location.href = '/fallo';
            }
        })
    }
}

function restar3(){
    const cookieString = document.cookie;
    const cookies = cookieString.split('; ');

    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].split('=');
        const cookieName = cookie[0];
        const cookieValue = cookie[1];

        if (cookieName === 'token') {
            token = cookieValue;
            break;
        }
    }

    if(token == null || !token){
        window.location.href = "/";
    }else{
        fetch('https://ticsproject.onrender.com/restar3', {
        method: 'GET',
        headers: {
            'token': token,
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data =>{
            
            if(data.success == "true"){
                window.location.href = '/home';
            }else{
                window.location.href = '/fallo';
            }
        })
    }
}
</script>

</body>
</html>