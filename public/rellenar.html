<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="./loginstyle.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>

<style>
    body::before {
    content: "";
    background-image: url('./images/fondohome.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1; /* Coloca la capa detrás del contenido */
    opacity: 0.08;
    filter: alpha(opacity=70);
  }

  .b1, .b2, .b3, .b4, .b5, .b6{
    display: none;
    width: 100%;
  }
</style>

<body style="display: flex; flex-direction: column; height: 100%;">
<!-- FORMULARIO INICIO DE SESION -->
<section>
    <p style="font-size: 4.5rem;">DiabetesCare</p>
    <p style="text-align: center;">Rellena tu información para administrar correctamente. Asegúrese que coincide con lo almacenado en el dispositivo.</p>
    <p style="text-align: center;">Si se le ha redirigido a esta pestaña sin aviso, significa que no le queda alguna dosis para utilizar.</p>
    <p style="text-align: center;">Si desea borrar o modificar los espacios, se recomienda dar click en "reestablecer" para organizar la información.</p>
    <div style="display: flex; align-items: center; justify-content: center;" >
        <button id="reset" type="submit" onclick="resetFunction()">Reestablecer</button>
    </div>

<script>

    function resetFunction(){
        const cookieString = document.cookie;
    const cookies = cookieString.split('; ');

    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].split('=');
        const cookieName = cookie[0];
        const cookieValue = cookie[1];

        if (cookieName === 'token') {
            token = cookieValue;
            break;
        }
    }

    if(token == null || !token){
        window.location.href = "/";
    }else{
        fetch('https://ticsproject.onrender.com/reset', {
        method: 'GET',
        headers: {
            'token': token,
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data =>{
            if(data.success == "true"){
                const modal1 = document.getElementById("modalBg");
                const modal2 = document.getElementById("cuidadoModal");

                modal1.style.display = "block";
                modal2.style.display = "block";
            }else{
                window.location.href = '/fallo';
            }


        })
    }
    }

</script>

</section>
<div class="" id="avisos"></div>
    <form id="lgn" action="/fill" method="POST">
        
        <h2 style="text-align: center;">Seleccione si utilizará espacios de dosis: </h2>

        <div style="display: flex; justify-content: space-around; width: 100%;">
        <div>
            <label class="lbl">Espacio 1</label>
            <input type="checkbox" id="c1" name="espacio1">
        </div>

        <div class="modal-bg" id="modalBg">a</div>    
        <div class="emergente" style="display: none;" id="cuidadoModal">
          <span class="close" onclick="cerrarModal()">&times;</span>
          Datos reestablecidos correctamente.
        </div>

        <style>
            .modal-bg{
              display: none;
              height: 100vh;
              width: 100vw;
              background: rgb(0, 0, 0);
              z-index: 100;
              position: fixed;
              top: 0;
              left: 0;
              opacity: 0.5;
            }
            .emergente{
              display: none;
              background: white;
              color: black;
              padding: 2rem;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              position: absolute;
              left: 50%;
              top: 50%;
              transform: translate(-50%, -50%);
              z-index: 3000;
            }
          </style>

          <script>
            function cerrarModal(){
            const modalBg = document.getElementById("modalBg");
            const modal = document.getElementById("cuidadoModal");
            modalBg.style.display = "none";
            modal.style.display = "none";
            }
          </script>

        <div>
            <label class="lbl">Espacio 2</label>
            <input type="checkbox" id="c2" name="espacio2">
        </div>

        <div>
            <label class="lbl">Espacio 3</label>
            <input type="checkbox" id="c3" name="espacio3">
        </div></div>
        
        <div id="1" class="b6">
            <label class="lbl" for="max1">Máxima cantidad de dosis (ml) espacio 1:</label>
            <input type="number" id="max1" name="max1">
        </div>

        <div id="2" class="b5">
            <label class="lbl" for="max2">Máxima cantidad de dosis (ml) espacio 2:</label>
            <input type="number" id="max2" name="max2">
        </div>

        <div id="3" class="b4">
            <label class="lbl" for="max3">Máxima cantidad de dosis (ml) espacio 3:</label>
            <input type="number" id="max3" name="max3">
        </div>
        
        <div id="11" class="b1">
            <label class="lbl" for="d1">Dosis a tomar (ml) espacio 1:</label>
            <input type="number" id="d1" name="d1">
        </div>

        <div id="22" class="b2">
            <label class="lbl" for="d2">Dosis a tomar (ml) espacio 2:</label>
            <input type="number" id="d2" name="d2">
        </div>

        <div id="33" class="b3">
            <label class="lbl" for="d3">Dosis a tomar (ml) espacio 3:</label>
            <input type="number" id="d3" name="d3">
        </div>

        <button type="submit">Finalizar</button>    
        
    </form>

    <div id="error-container" style="display: flex; justify-content: center;  color: red; margin-bottom: 1rem; font-size: 2rem;"></div>
    

    <script src="./js/fill.js"></script>


    <script>//fetch
        //logica para agregar boxes
        document.addEventListener("DOMContentLoaded", function() {
            const checkbox1 = document.getElementById("c1");
            const checkbox2 = document.getElementById("c2");
            const checkbox3 = document.getElementById("c3");
            
            const max1 = document.getElementById("1");
            const max2 = document.getElementById("2");
            const max3 = document.getElementById("3");
        
            const d1 = document.getElementById("11");
            const d2 = document.getElementById("22");
            const d3 = document.getElementById("33");
        
            checkbox1.addEventListener("change", function() {
                var value1 = checkbox1.checked;
        
                if(value1){
                    d1.style.display = "block";
                    max1.style.display = "block";
                }else{
                    d1.style.display = "none";
                    max1.style.display = "none";
                }
        
                
            });
            checkbox2.addEventListener("change", function() {
                var value2 = checkbox2.checked;
        
                if(value2){
                    d2.style.display = "block";
                    max2.style.display = "block";
                }else{
                    d2.style.display = "none";
                    max2.style.display = "none";
                }
        
            });
            checkbox3.addEventListener("change", function() {
                var value3 = checkbox3.checked;
        
                if(value3){
                    d3.style.display = "block";
                    max3.style.display = "block";
                }else{
                    d3.style.display = "none";
                    max3.style.display = "none";
                }
        
            });
        });</script>
</body>
</html>